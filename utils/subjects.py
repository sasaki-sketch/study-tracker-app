"""
ç§‘ç›®åé–¢é€£ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
"""
from typing import Optional

# ç§‘ç›®ã®åˆ¥åãƒ»ç•¥ç§°ãƒãƒƒãƒ”ãƒ³ã‚°
SUBJECT_ALIASES = {
    # 1æ¬¡è©¦é¨“ç§‘ç›®
    "è²¡å‹™": "è²¡å‹™ä¼šè¨ˆ",
    "è²¡å‹™ä¼šè¨ˆè«–": "è²¡å‹™ä¼šè¨ˆ",
    "ä¼æ¥­çµŒå–¶": "ä¼æ¥­çµŒå–¶ç†è«–",
    "ä¼æ¥­çµŒå–¶è«–": "ä¼æ¥­çµŒå–¶ç†è«–",
    "çµŒå–¶ç†è«–": "ä¼æ¥­çµŒå–¶ç†è«–",
    "é‹ç®¡": "é‹å–¶ç®¡ç†",
    "ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³": "é‹å–¶ç®¡ç†",
    "çµŒæ¸ˆ": "çµŒæ¸ˆå­¦",
    "æƒ…å ±": "çµŒå–¶æƒ…å ±ã‚·ã‚¹ãƒ†ãƒ ",
    "ã‚·ã‚¹ãƒ†ãƒ ": "çµŒå–¶æƒ…å ±ã‚·ã‚¹ãƒ†ãƒ ",
    "çµŒå–¶æƒ…å ±": "çµŒå–¶æƒ…å ±ã‚·ã‚¹ãƒ†ãƒ ",
    "æ³•å‹™": "çµŒå–¶æ³•å‹™",
    "ä¸­å°": "ä¸­å°ä¼æ¥­çµŒå–¶æ”¿ç­–",
    "æ”¿ç­–": "ä¸­å°ä¼æ¥­çµŒå–¶æ”¿ç­–",
    "ä¸­å°ä¼æ¥­": "ä¸­å°ä¼æ¥­çµŒå–¶æ”¿ç­–",

    # 2æ¬¡è©¦é¨“ç§‘ç›®
    "äº‹ä¾‹1": "äº‹ä¾‹I",
    "äº‹ä¾‹â… ": "äº‹ä¾‹I",
    "çµ„ç¹”": "äº‹ä¾‹I",
    "äº‹ä¾‹2": "äº‹ä¾‹II",
    "äº‹ä¾‹â…¡": "äº‹ä¾‹II",
    "ãƒãƒ¼ã‚±": "äº‹ä¾‹II",
    "ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°": "äº‹ä¾‹II",
    "äº‹ä¾‹3": "äº‹ä¾‹III",
    "äº‹ä¾‹â…¢": "äº‹ä¾‹III",
    "ç”Ÿç”£": "äº‹ä¾‹III",
    "ã‚ªãƒš": "äº‹ä¾‹III",
    "äº‹ä¾‹4": "äº‹ä¾‹IV",
    "äº‹ä¾‹â…£": "äº‹ä¾‹IV",
    "è²¡å‹™ä¼šè¨ˆ": "äº‹ä¾‹IV",  # 2æ¬¡è©¦é¨“ã®è²¡å‹™

    # ãã®ä»–
    "çµ±è¨ˆ": "çµ±è¨ˆæ¤œå®š2ç´š",
    "çµ±è¨ˆæ¤œå®š": "çµ±è¨ˆæ¤œå®š2ç´š",
}

# ç§‘ç›®çµµæ–‡å­—ãƒãƒƒãƒ”ãƒ³ã‚°
SUBJECT_EMOJI_MAP = {
    "è²¡å‹™ä¼šè¨ˆ": "ğŸ’°",
    "ä¼æ¥­çµŒå–¶ç†è«–": "ğŸ“Š",
    "é‹å–¶ç®¡ç†": "ğŸ­",
    "çµŒæ¸ˆå­¦": "ğŸ“ˆ",
    "çµŒå–¶æƒ…å ±ã‚·ã‚¹ãƒ†ãƒ ": "ğŸ’»",
    "çµŒå–¶æ³•å‹™": "âš–ï¸",
    "ä¸­å°ä¼æ¥­çµŒå–¶æ”¿ç­–": "ğŸ¢",
    "äº‹ä¾‹I": "ğŸ‘¥",
    "äº‹ä¾‹II": "ğŸ“¢",
    "äº‹ä¾‹III": "âš™ï¸",
    "äº‹ä¾‹IV": "ğŸ’¹",
    "çµ±è¨ˆæ¤œå®š2ç´š": "ğŸ“Š",
}


def normalize_subject_name(subject: str) -> Optional[str]:
    """
    ç§‘ç›®åã‚’æ­£è¦åŒ–ã™ã‚‹

    Args:
        subject: å…¥åŠ›ã•ã‚ŒãŸç§‘ç›®åï¼ˆç•¥ç§°ã‚„åˆ¥åã®å¯èƒ½æ€§ã‚ã‚Šï¼‰

    Returns:
        æ­£è¦åŒ–ã•ã‚ŒãŸç§‘ç›®åã€‚ãƒãƒƒãƒã—ãªã„å ´åˆã¯None

    Examples:
        >>> normalize_subject_name("è²¡å‹™")
        'è²¡å‹™ä¼šè¨ˆ'
        >>> normalize_subject_name("äº‹ä¾‹1")
        'äº‹ä¾‹I'
        >>> normalize_subject_name("ãƒãƒ¼ã‚±")
        'äº‹ä¾‹II'
    """
    if not subject:
        return None

    # å‰å¾Œã®ç©ºç™½ã‚’å‰Šé™¤
    subject = subject.strip()

    # å®Œå…¨ä¸€è‡´ã™ã‚‹æ­£å¼åç§°ã®å ´åˆ
    if subject in SUBJECT_EMOJI_MAP:
        return subject

    # åˆ¥åãƒ»ç•¥ç§°ã‹ã‚‰ãƒãƒƒãƒ”ãƒ³ã‚°
    if subject in SUBJECT_ALIASES:
        return SUBJECT_ALIASES[subject]

    # å¤§æ–‡å­—å°æ–‡å­—ã‚’ç„¡è¦–ã—ã¦ãƒãƒƒãƒãƒ³ã‚°
    subject_lower = subject.lower()
    for alias, canonical in SUBJECT_ALIASES.items():
        if alias.lower() == subject_lower:
            return canonical

    # ãƒãƒƒãƒã—ãªã„å ´åˆã¯None
    return None


def get_subject_emoji(subject: str) -> str:
    """
    ç§‘ç›®ã«å¯¾å¿œã™ã‚‹çµµæ–‡å­—ã‚’å–å¾—

    Args:
        subject: ç§‘ç›®å

    Returns:
        çµµæ–‡å­—ï¼ˆè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ğŸ“šï¼‰
    """
    return SUBJECT_EMOJI_MAP.get(subject, "ğŸ“š")


def format_subject_with_emoji(subject: str) -> str:
    """
    ç§‘ç›®åã‚’çµµæ–‡å­—ä»˜ãã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

    Args:
        subject: ç§‘ç›®å

    Returns:
        çµµæ–‡å­— + ç§‘ç›®åã®å½¢å¼ï¼ˆä¾‹: "ğŸ’° è²¡å‹™ä¼šè¨ˆ"ï¼‰
    """
    emoji = get_subject_emoji(subject)
    return f"{emoji} {subject}"
